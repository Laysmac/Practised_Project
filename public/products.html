<!DOCTYPE html>
<html lang="en">

<head>
    <title>Product CRUD</title>
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/node_modules/bootstrap-icons/font/bootstrap-icons.css">
    <script src="/node_modules/jquery/dist/jquery.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script>
        $(() => {
            function LoadProducts() {
                $.ajax({
                    method: 'GET',
                    url: 'http://127.0.0.1:4300/products',
                    success: (data) => {
                        $.each(data, (key, val) => {
                            $(`<tr>
                                    <td>
                                        ${val.Name}
                                    </td>
                                    <td>
                                        ${val.Price}
                                    </td>
                                    <td>
                                        ${(val.Stock==true)?"Available":"Out Of Stock"}
                                    </td>
                                    <td>
                                        ${val.Category}
                                    </td> 
                                    <td>
                                        ${val.Rating}
                                    </td>  
                                    <td>
                                        <button class="btn btn-info" id="btnUpdate"><span class="bi bi-pen-fill"></span></button>
                                        <button class="btn btn-danger" id="btnDelete"><span class="bi bi-trash-fill"></span></button>
                                    </td> 
                                </tr>`).appendTo("tbody");
                        })
                    }
                })
            }

            function LoadCategories() {
                $.ajax({
                    method: 'GET',
                    url: 'http://127.0.0.1:4300/categories',
                    success: (data) => {
                        data.unshift({
                            CategoryId: -1,
                            Category: "Select Category"
                        });
                        $.each(data, (key, val) => {
                            $(`<option>${val.Category}</option>`).appendTo("#Category");
                        })
                    }
                })
            }

            LoadProducts();
            LoadCategories();

            $("#btnAdd").click(() => {
                var formData = {
                    ProductId: $("#ProductId").val(),
                    Name: $("#Name").val(),
                    Price: $("#Price").val(),
                    Category: $("#Category").val(),
                    Stock: $("#Stock").prop("checked"),
                    Rating: $("#Rating").val()
                }
                $.ajax({
                    method: 'POST',
                    url: 'http://127.0.0.1:4300/addproduct',
                    data: formData
                })
                alert("Record Inserted");
                location.reload();
            });

        })
    </script>
</head>

<body class="container-fluid">
    <header class="bg-danger text-white text-center p-2">
        <h2>CRUD Operations</h2>
    </header>
    <div class="row mt-2">
        <div class="col-3">
            <div>
                <dl>
                    <dt>Product Id</dt>
                    <dd>
                        <input type="number" id="ProductId" class="form-control">
                    </dd>
                    <dt>Name</dt>
                    <dd>
                        <input type="text" id="Name" class="form-control">
                    </dd>
                    <dt>Price</dt>
                    <dd>
                        <input type="text" id="Price" class="form-control">
                    </dd>
                    <dt>Category</dt>
                    <dd>
                        <select id="Category" class="form-select">

                        </select>
                    </dd>
                    <dt>Stock</dt>
                    <dd>
                        <input type="checkbox" id="Stock"> In Stock
                    </dd>
                    <dt>Rating</dt>
                    <dd>
                        <input class="form-control" type="number" min="1" max="5" step="0.1" id="Rating">
                    </dd>
                </dl>
                <button class="btn btn-primary w-100" id="btnAdd">Add Product</button>
            </div>
        </div>
        <div class="col-9">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Category</th>
                        <th>Rating</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
</body>

</html>